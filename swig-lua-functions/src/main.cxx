
extern "C" {
  
#include <lua.h>
#include <lualib.h>
#include <lauxlib.h>

// Generated by SWIG.
extern int luaopen_proto (lua_State *);

}

#include <cstdio>

#include <string>

#include <core/vec.h>
#include <lua/state.h>
#include <swig/swigluarun.h>


int main () {
  lua::State L;
  L.loadlibs();
  if (L.loadmodule("unused", luaopen_proto) != lua::status::OK()) {
    puts("NOT");
    return EXIT_FAILURE;
  }
  
  base::vec2 v(1,1);
  //swig_type_info *base_vec2 = SWIG_MangledTypeQuery(L.get(), "_p_base__vec2");
  swig_type_info *base_vec2 = SWIG_TypeQuery(L.get(), "base::vec2*");

  SWIG_NewPointerObj (
      L.get(),
      (void*)&v,
      base_vec2,
      0
  );
  lua_setglobal(L.get(), "exported");

  puts(base_vec2->str);

  if (L.dofile("scripts/prog.lua") != lua::status::OK()) {
    return EXIT_FAILURE;
  }
  return 0;
}


